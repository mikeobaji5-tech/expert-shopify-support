<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shopify Staff Support</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* --- Loading screen --- */
    #loading-screen {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #fff;
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      z-index: 9999;
      font-family: Arial, sans-serif;
    }
    #loading-text { font-size: 1.2rem; margin-top: 15px; color: #333; }
    .spinner {
      border: 6px solid #f3f3f3;
      border-top: 6px solid #5c6ac4;
      border-radius: 50%;
      width: 60px; height: 60px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* --- Popup --- */
    #supportPopup {
      display: none;
      position: fixed;
      bottom: 20px; right: 20px;
      width: 320px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 12px;
      box-shadow: 0px 4px 12px rgba(0,0,0,0.15);
      padding: 20px;
      z-index: 10000;
    }
    #supportPopup h3 { margin-bottom: 10px; }
    #supportPopup label { font-size: 0.9rem; display: block; margin: 6px 0 2px; }
    #supportPopup select, #supportPopup textarea {
      width: 100%; padding: 6px;
      border: 1px solid #ccc; border-radius: 6px;
    }
    #supportPopup button {
      background: #5c6ac4; color: #fff;
      border: none; border-radius: 6px;
      padding: 8px 12px;
      margin-top: 10px;
      cursor: pointer;
      width: 100%;
    }

    /* Countdown */
    #countdown {
      font-size: 1rem; font-weight: bold;
      color: #e63946;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loading-screen">
    <div class="spinner"></div>
    <div id="loading-text">Loading staff tools…</div>
  </div>

  <!-- Main Content -->
  <div id="main-content" style="display:none;">
    <h1>Shopify Staff Support</h1>
    <p>Welcome to official staff assistance.</p>

    <div id="countdown"></div>

    <button onclick="openPopup()">Get Support</button>
  </div>

  <!-- Popup -->
  <div id="supportPopup">
    <h3>Connect with Support</h3>
    <form id="supportForm">
      <label>Store Status</label>
      <select name="status">
        <option value="Active">Active</option>
        <option value="New">New</option>
        <option value="Struggling">Struggling</option>
        <option value="Locked">Locked</option>
      </select>

      <label>Main Challenge</label>
      <select name="challenge">
        <option value="SEO">SEO</option>
        <option value="Conversion">Conversion</option>
        <option value="Payments">Payments</option>
        <option value="Compliance">Compliance</option>
        <option value="Other">Other</option>
      </select>

      <label>Your Message</label>
      <textarea name="message" rows="3" placeholder="Explain your challenge..."></textarea>

      <button type="submit">Send to WhatsApp</button>
    </form>
  </div>

  <script>
    /* --- Loading Screen --- */
    const loadingMessages = [
      "Connecting to staff dashboard…",
      "Checking compliance tools…",
      "Syncing with Shopify database…",
      "Preparing staff interface…",
      "Almost ready…"
    ];
    let msgIndex = 0;
    const loadingText = document.getElementById("loading-text");

    setInterval(() => {
      msgIndex = (msgIndex + 1) % loadingMessages.length;
      loadingText.textContent = loadingMessages[msgIndex];
    }, 1200);

    // Keep visible for at least 5s
    window.addEventListener("load", () => {
      setTimeout(() => {
        document.getElementById("loading-screen").style.display = "none";
        document.getElementById("main-content").style.display = "block";
      }, 5000);
    });

    /* --- Countdown (resets once per day with cookies) --- */
    function setCookie(name, value, hours) {
      const d = new Date();
      d.setTime(d.getTime() + (hours*60*60*1000));
      document.cookie = name + "=" + value + ";expires=" + d.toUTCString() + ";path=/";
    }
    function getCookie(name) {
      let match = document.cookie.match(new RegExp("(^| )" + name + "=([^;]+)"));
      if (match) return match[2];
      return null;
    }

    function startCountdown() {
      let saved = getCookie("countdown");
      let target;
      if (saved) {
        target = new Date(saved);
      } else {
        target = new Date();
        target.setHours(23,59,59,999); // End of today
        setCookie("countdown", target.toISOString(), 24);
      }

      function updateCountdown() {
        const now = new Date();
        const diff = target - now;
        if (diff <= 0) {
          document.getElementById("countdown").textContent = "Offer expired. Refresh tomorrow!";
          return;
        }
        const hrs = Math.floor(diff / (1000*60*60));
        const mins = Math.floor((diff % (1000*60*60)) / (1000*60));
        const secs = Math.floor((diff % (1000*60)) / 1000);
        document.getElementById("countdown").textContent = `⏳ Ends in ${hrs}h ${mins}m ${secs}s`;
      }
      updateCountdown();
      setInterval(updateCountdown, 1000);
    }
    startCountdown();

    /* --- Popup --- */
    function openPopup() {
      document.getElementById("supportPopup").style.display = "block";
    }

    document.getElementById("supportForm").addEventListener("submit", function(e){
      e.preventDefault();
      const status = this.status.value;
      const challenge = this.challenge.value;
      const message = this.message.value;

      const text = `📌 Store Status: ${status}%0A⚡ Challenge: ${challenge}%0A📝 Message: ${encodeURIComponent(message)}`;
      const phone = "2349032365125"; // Your WhatsApp Business number
      window.open(`https://wa.me/${phone}?text=${text}`, "_blank");
    });
  </script>
</body>
</html>
